{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/patri/Documents/tp5-QuirogaPatricioAlejandro-backend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Espectador } from 'src/app/models/espectador';\nimport { Ticket } from 'src/app/models/ticket';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/ticket.service\";\nimport * as i2 from \"src/app/services/espectador.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction TicketFormComponent_div_7_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" El precio del ticket es requerido. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TicketFormComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, TicketFormComponent_div_7_div_1_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r0 = i0.ɵɵreference(1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r0.errors == null ? null : _r0.errors[\"required\"]);\n  }\n}\nfunction TicketFormComponent_div_17_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" La categor\\u00EDa del espectador es requerida. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TicketFormComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, TicketFormComponent_div_17_div_1_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r3 = i0.ɵɵreference(12);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r3.errors == null ? null : _r3.errors[\"required\"]);\n  }\n}\nfunction TicketFormComponent_div_23_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" La fecha de compra es requerida. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TicketFormComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, TicketFormComponent_div_23_div_1_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r5 = i0.ɵɵreference(22);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r5.errors == null ? null : _r5.errors[\"required\"]);\n  }\n}\nfunction TicketFormComponent_option_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const e_r14 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", e_r14);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", e_r14.nombre, \" \", e_r14.apellido, \"\");\n  }\n}\nfunction TicketFormComponent_button_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function TicketFormComponent_button_32_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.guardarTicket());\n    });\n    i0.ɵɵtext(1, \" Guardar \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r0 = i0.ɵɵreference(1);\n    i0.ɵɵproperty(\"disabled\", _r0.invalid);\n  }\n}\nfunction TicketFormComponent_button_33_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function TicketFormComponent_button_33_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.modificarTicket(ctx_r17.ticket));\n    });\n    i0.ɵɵtext(1, \" Modificar \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r0 = i0.ɵɵreference(1);\n    i0.ɵɵproperty(\"disabled\", _r0.invalid);\n  }\n}\nexport class TicketFormComponent {\n  constructor(servicio, espService, activatedRoute, router) {\n    this.servicio = servicio;\n    this.espService = espService;\n    this.activatedRoute = activatedRoute;\n    this.router = router;\n    this.accion = \"\";\n    this.ticket = new Ticket();\n    this.espectadores = new Array();\n  }\n  ngOnInit() {\n    var _this = this;\n    this.activatedRoute.params.subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (params) {\n        if (params['id'] == \"0\") {\n          _this.accion = \"new\";\n          _this.cargarEspectadores();\n        } else {\n          _this.accion = \"update\";\n          yield _this.cargarEspectadores(); // con el await me aseguro de que carguen los espectadores antes de cargar el ticket\n          _this.cargarTicket(params['id']);\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n  cargarTicket(id) {\n    this.servicio.getTicket(id).subscribe(result => {\n      console.log(result);\n      Object.assign(this.ticket, result);\n      this.ticket.espectador = this.espectadores.find(item => item._id == this.ticket.espectador._id);\n    }, error => {});\n  }\n  guardarTicket() {\n    this.servicio.newTicket(this.ticket).subscribe(result => {\n      if (result.status == 1) alert(result.msg);\n      this.router.navigate([\"ticket\"]);\n    }, error => {\n      alert(error.msg);\n    });\n  }\n  cargarEspectadores() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.espService.getEspectadores().subscribe(result => {\n        result.forEach(element => {\n          let unEspectador = new Espectador();\n          Object.assign(unEspectador, element);\n          _this2.espectadores.push(unEspectador);\n          unEspectador = new Espectador();\n        });\n      }, error => {});\n    })();\n  }\n  modificarTicket(ticket) {\n    this.servicio.editTicket(ticket).subscribe(result => {\n      alert(\"se modifico\");\n      this.router.navigate([\"ticket\"]);\n    });\n  }\n  volver() {\n    this.router.navigate([\"ticket\"]);\n  }\n}\nTicketFormComponent.ɵfac = function TicketFormComponent_Factory(t) {\n  return new (t || TicketFormComponent)(i0.ɵɵdirectiveInject(i1.TicketService), i0.ɵɵdirectiveInject(i2.EspectadorService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n};\nTicketFormComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TicketFormComponent,\n  selectors: [[\"app-ticket-form\"]],\n  decls: 34,\n  vars: 10,\n  consts: [[1, \"container\", \"col-5\"], [\"precioTicket\", \"ngForm\"], [1, \"mb-3\"], [\"for\", \"iddni\", 1, \"form-label\"], [\"type\", \"number\", \"id\", \"iddni\", \"name\", \"dni\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"precioTicket\", \"ngModel\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [\"for\", \"idprecio\", 1, \"form-label\"], [\"name\", \"catEsp\", \"id\", \"id\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"categoriaEspectador\", \"ngModel\"], [\"value\", \"l\"], [\"value\", \"e\"], [\"for\", \"idte\", 1, \"form-label\"], [\"type\", \"text\", \"id\", \"idprecio\", \"name\", \"tipoEspectador\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"fechaCompra\", \"ngModel\"], [\"for\", \"idfc\", 1, \"form-label\"], [\"name\", \"espectador\", \"id\", \"id\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"espectador\", \"ngModel\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", \"class\", \"btn btn-primary\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [1, \"alert\", \"alert-danger\"], [4, \"ngIf\"], [3, \"ngValue\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"]],\n  template: function TicketFormComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0, 1)(2, \"div\", 2)(3, \"label\", 3);\n      i0.ɵɵtext(4, \"Precio Ticket\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"input\", 4, 5);\n      i0.ɵɵlistener(\"ngModelChange\", function TicketFormComponent_Template_input_ngModelChange_5_listener($event) {\n        return ctx.ticket.precioTicket = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(7, TicketFormComponent_div_7_Template, 2, 1, \"div\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"div\", 2)(9, \"label\", 7);\n      i0.ɵɵtext(10, \"Categoria Espectador\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"select\", 8, 9);\n      i0.ɵɵlistener(\"ngModelChange\", function TicketFormComponent_Template_select_ngModelChange_11_listener($event) {\n        return ctx.ticket.categoriaEspectador = $event;\n      });\n      i0.ɵɵelementStart(13, \"option\", 10);\n      i0.ɵɵtext(14, \"Local\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"option\", 11);\n      i0.ɵɵtext(16, \"Extranjero\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(17, TicketFormComponent_div_17_Template, 2, 1, \"div\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"div\", 2)(19, \"label\", 12);\n      i0.ɵɵtext(20, \"Fecha de Compra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(21, \"input\", 13, 14);\n      i0.ɵɵlistener(\"ngModelChange\", function TicketFormComponent_Template_input_ngModelChange_21_listener($event) {\n        return ctx.ticket.fechaCompra = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(23, TicketFormComponent_div_23_Template, 2, 1, \"div\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(24, \"div\", 2)(25, \"label\", 15);\n      i0.ɵɵtext(26, \"Espectador\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(27, \"select\", 16, 17);\n      i0.ɵɵlistener(\"ngModelChange\", function TicketFormComponent_Template_select_ngModelChange_27_listener($event) {\n        return ctx.ticket.espectador = $event;\n      });\n      i0.ɵɵtemplate(29, TicketFormComponent_option_29_Template, 2, 3, \"option\", 18);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(30, \"br\")(31, \"br\");\n      i0.ɵɵtemplate(32, TicketFormComponent_button_32_Template, 2, 1, \"button\", 19);\n      i0.ɵɵtemplate(33, TicketFormComponent_button_33_Template, 2, 1, \"button\", 19);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(1);\n      const _r3 = i0.ɵɵreference(12);\n      const _r5 = i0.ɵɵreference(22);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngModel\", ctx.ticket.precioTicket);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", _r0.invalid && (_r0.dirty || _r0.touched));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.ticket.categoriaEspectador);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngIf\", _r3.invalid && (_r3.dirty || _r3.touched));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.ticket.fechaCompra);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", _r5.invalid && (_r5.dirty || _r5.touched));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.ticket.espectador);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.espectadores);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.accion == \"new\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.accion == \"update\");\n    }\n  },\n  dependencies: [i4.NgForOf, i4.NgIf, i5.ɵNgNoValidate, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.NgModel, i5.NgForm],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Espectador","Ticket","i0","TicketFormComponent","constructor","servicio","espService","activatedRoute","router","ticket","espectadores","Array","ngOnInit","params","subscribe","accion","cargarEspectadores","cargarTicket","id","getTicket","result","console","log","Object","assign","espectador","find","item","_id","error","guardarTicket","newTicket","status","alert","msg","navigate","getEspectadores","forEach","element","unEspectador","push","modificarTicket","editTicket","volver","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\patri\\Documents\\tp5-QuirogaPatricioAlejandro-backend\\frontend\\src\\app\\components\\ticket-form\\ticket-form.component.ts","C:\\Users\\patri\\Documents\\tp5-QuirogaPatricioAlejandro-backend\\frontend\\src\\app\\components\\ticket-form\\ticket-form.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Espectador } from 'src/app/models/espectador';\r\nimport { Ticket } from 'src/app/models/ticket';\r\nimport { EspectadorService } from 'src/app/services/espectador.service';\r\nimport { TicketService } from 'src/app/services/ticket.service';\r\n\r\n@Component({\r\n  selector: 'app-ticket-form',\r\n  templateUrl: './ticket-form.component.html',\r\n  styleUrls: ['./ticket-form.component.css']\r\n})\r\nexport class TicketFormComponent implements OnInit{\r\n\r\n  ticket!:Ticket;\r\n  accion:string=\"\";\r\n\r\n  espectadores! : Array<Espectador>;\r\n\r\n  constructor (private servicio:TicketService,private espService:EspectadorService, private activatedRoute: ActivatedRoute,private router:Router){\r\n    this.ticket = new Ticket();\r\n    this.espectadores = new Array<Espectador>();\r\n  }\r\n\r\nngOnInit():void{\r\n\r\n  this.activatedRoute.params.subscribe(async params => {\r\n    if(params['id'] == \"0\"){\r\n      this.accion =\"new\";\r\n      this.cargarEspectadores();\r\n    }else {\r\n      this.accion = \"update\";\r\n      await this.cargarEspectadores() // con el await me aseguro de que carguen los espectadores antes de cargar el ticket\r\n      this.cargarTicket(params['id']) \r\n    }\r\n  });\r\n}\r\n\r\ncargarTicket(id : string){\r\n  this.servicio.getTicket(id).subscribe(\r\n    result=>{\r\n      console.log(result)\r\n      Object.assign(this.ticket,result);\r\n       this.ticket.espectador = this.espectadores.find(item => (item._id == this.ticket.espectador._id))!;\r\n      \r\n    },\r\n    error=>{\r\n\r\n    }\r\n  )\r\n}\r\n\r\nguardarTicket(){\r\n  this.servicio.newTicket(this.ticket).subscribe(\r\n    (result:any)=>{\r\n      if (result.status == 1)\r\n      alert(result.msg)\r\n      this.router.navigate([\"ticket\"])\r\n    },\r\n    error=>{\r\n      alert(error.msg)\r\n    }\r\n  )\r\n}\r\n\r\nasync cargarEspectadores(){\r\nthis.espService.getEspectadores().subscribe(\r\n  result=>{\r\n    result.forEach((element:any) => {\r\n      let unEspectador = new Espectador();\r\n      Object.assign(unEspectador,element);\r\n      this.espectadores.push(unEspectador);\r\n      unEspectador = new Espectador();\r\n    });\r\n  },\r\n  error=>{\r\n\r\n  }\r\n)\r\n\r\n}\r\n\r\n\r\nmodificarTicket(ticket:Ticket){\r\n  this.servicio.editTicket(ticket).subscribe(\r\n    result =>{\r\n      alert(\"se modifico\")\r\n      this.router.navigate([\"ticket\"])\r\n    }\r\n  )\r\n}\r\n\r\nvolver(){\r\n  this.router.navigate([\"ticket\"])\r\n}\r\n}\r\n","<!-- <button  type=\"submit\"  class=\"btn btn-secondary\" (click)=\"volver()\">Volver</button>\r\n\r\n<form class=\"container col-5\">\r\n    <div class=\"mb-3\">\r\n      <label for=\"iddni\" class=\"form-label\">Precio Ticket</label> \r\n      \r\n  \r\n      <input type=\"number\" class=\"form-control\" id=\"iddni\" [(ngModel)]=\"ticket.precioTicket\" name=\"dni\" >\r\n    </div>\r\n   \r\n    <div class=\"mb-3\">\r\n        <label for=\"idprecio\" class=\"form-label\">Categoria Espectador</label>\r\n        <select name=\"catEsp\" id=\"id\" [(ngModel)]=\"ticket.categoriaEspectador\">\r\n            <option value=\"l\">Local</option>\r\n            <option value=\"e\">Extranjero</option>\r\n          </select>\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"idte\" class=\"form-label\">Fecha de Compra</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"idprecio\" [(ngModel)]=\"ticket.fechaCompra\" name=\"tipoEspectador\" >\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"idfc\" class=\"form-label\">Espectador </label>\r\n       \r\n      </div>\r\n      <select name=\"espectador\" id=\"id\" [(ngModel)]=\"ticket.espectador\">\r\n        <option *ngFor=\" let e of espectadores\" [ngValue]=\"e\">{{e.nombre}} {{e.apellido}}</option>\r\n      </select>\r\n    \r\n   \r\n    <br>\r\n    <br>\r\n\r\n    <button  type=\"submit\" *ngIf=\"accion=='new'\" class=\"btn btn-primary\" (click)=\"guardarTicket()\">Guardar</button>\r\n    \r\n    <button  type=\"submit\" *ngIf=\"accion=='update'\" class=\"btn btn-primary\" (click)=\"modificarTicket(ticket)\">Modificar</button>\r\n \r\n</form> -->\r\n<form class=\"container col-5\" #precioTicket=\"ngForm\">\r\n  <div class=\"mb-3\">\r\n    <label for=\"iddni\" class=\"form-label\">Precio Ticket</label>\r\n    <input type=\"number\" class=\"form-control\" id=\"iddni\" [(ngModel)]=\"ticket.precioTicket\" name=\"dni\" required #precioTicket=\"ngModel\">\r\n    \r\n    <div *ngIf=\"precioTicket.invalid && (precioTicket.dirty || precioTicket.touched)\" class=\"alert alert-danger\">\r\n      <div *ngIf=\"precioTicket.errors?.['required']\">\r\n        El precio del ticket es requerido.\r\n      </div>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"mb-3\">\r\n    <label for=\"idprecio\" class=\"form-label\">Categoria Espectador</label>\r\n    <select name=\"catEsp\" id=\"id\" [(ngModel)]=\"ticket.categoriaEspectador\" required #categoriaEspectador=\"ngModel\">\r\n      <option value=\"l\">Local</option>\r\n      <option value=\"e\">Extranjero</option>\r\n    </select>\r\n    \r\n    <div *ngIf=\"categoriaEspectador.invalid && (categoriaEspectador.dirty || categoriaEspectador.touched)\" class=\"alert alert-danger\">\r\n      <div *ngIf=\"categoriaEspectador.errors?.['required']\">\r\n        La categoría del espectador es requerida.\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"mb-3\">\r\n    <label for=\"idte\" class=\"form-label\">Fecha de Compra</label>\r\n    <input type=\"text\" class=\"form-control\" id=\"idprecio\" [(ngModel)]=\"ticket.fechaCompra\" name=\"tipoEspectador\" required #fechaCompra=\"ngModel\">\r\n    \r\n    <div *ngIf=\"fechaCompra.invalid && (fechaCompra.dirty || fechaCompra.touched)\" class=\"alert alert-danger\">\r\n      <div *ngIf=\"fechaCompra.errors?.['required']\">\r\n        La fecha de compra es requerida.\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"mb-3\">\r\n    <label for=\"idfc\" class=\"form-label\">Espectador</label>\r\n  </div>\r\n  <select name=\"espectador\" id=\"id\" [(ngModel)]=\"ticket.espectador\" required #espectador=\"ngModel\">\r\n    <option *ngFor=\"let e of espectadores\" [ngValue]=\"e\">{{ e.nombre }} {{ e.apellido }}</option>\r\n  </select>\r\n\r\n  <br>\r\n  <br>\r\n\r\n  <button type=\"submit\" *ngIf=\"accion == 'new'\" class=\"btn btn-primary\" (click)=\"guardarTicket()\" [disabled]=\"precioTicket.invalid\">\r\n    Guardar\r\n  </button>\r\n\r\n  <button type=\"submit\" *ngIf=\"accion == 'update'\" class=\"btn btn-primary\" (click)=\"modificarTicket(ticket)\" [disabled]=\"precioTicket.invalid\">\r\n    Modificar\r\n  </button>\r\n</form>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}